**定理（子集反演）**

设两个关于集合的函数 $f, g$ 满足
$$
f(S)=\sum_{T\subseteq S}g(T)
$$
那么就有
$$
g(S)=\sum_{T\subseteq S}(-1)^{|S|-|T|}f(T)
$$
**证明**
$$
\begin{align}
\sum_{T\subseteq S}(-1)^{|S|-|T|}f(T)&=\sum_{T\subseteq S}(-1)^{|S|-|T|}\sum_{Q\subseteq T}g(Q)\\
&=\sum_{Q\subseteq S}g(Q)\sum_{Q\subseteq T\subseteq S}(-1)^{|S|-|T|}\\
&=\sum_{Q\subseteq S}g(Q)\sum_{T\subseteq S\setminus Q}(-1)^{|S\setminus Q|-|T|}\\
&=\sum_{Q\subseteq S}g(Q)\sum_{k=0}^{|S\setminus Q|}\binom{|S\setminus Q|}{k}(-1)^{|S\setminus Q|-k}\\
&=\sum_{Q\subseteq S}g(Q)[|S\setminus Q|=0]\\
&=g(S)
\end{align}
$$
**推论**

设两个关于集合的函数 $f(S), g(S)$ 满足
$$
f(S)=\sum_{S\subseteq T}g(T)
$$
那么就有
$$
g(S)=\sum_{S\subseteq T}(-1)^{|T|-|S|}f(T)
$$
**定理（容斥原理）**
$$
\left|\bigcap_{i=1}^nA_i\right|=\sum_{S\subseteq\{1,2,\dots,n\}}(-1)^{|S|}\left|\bigcap_{i\in S}\overline{A_i}\right|
$$
**证明**

令
$$
f(S)=\left|\bigcap_{i\in S}\overline{A_i}\right|
$$

$$
g(S)=\left|\bigcap_{i\in S}\overline{A_i}\cap\bigcap_{i\notin S}A_i\right|
$$

易证
$$
f(S)=\sum_{S\subseteq T}g(T)
$$
应用子集反演有
$$
g(S)=\sum_{S\subseteq T}(-1)^{|T|-|S|}f(T)
$$
于是
$$
\begin{align}
\left|\bigcap_{i=1}^nA_i\right|&=g(\empty)\\
&=\sum_{S\subseteq\{1,2,\dots,n\}}(-1)^{|S|}f(S)\\
&=\sum_{S\subseteq\{1,2,\dots,n\}}(-1)^{|S|}\left|\bigcap_{i\in S}\overline{A_i}\right|
\end{align}
$$
**推论**
$$
\left|\bigcup_{i=1}^nA_i\right|=\sum_{\empty\subset S\subseteq\{1,2,\dots,n\}}(-1)^{|S|-1}\left|\bigcap_{i\in S}A_i\right|
$$
**证明**
$$
\begin{align}
\left|\bigcup_{i=1}^nA_i\right|&=|U|-\left|\bigcap_{i=1}^n\overline{A_i}\right|\\
&=|U|-\sum_{S\subseteq\{1,2,\dots,n\}}(-1)^{|S|}\left|\bigcap_{i\in S}A_i\right|\\
&=\sum_{\empty\subset S\subseteq\{1,2,\dots,n\}}(-1)^{|S|-1}\left|\bigcap_{i\in S}A_i\right|
\end{align}
$$
**定理（二项式反演）**

设两个函数 $f, g$ 满足
$$
f_i=\sum_{j=0}^i\binom{i}{j}g_j
$$
那么就有
$$
g_i=\sum_{j=0}^i(-1)^{i-j}\binom{i}{j}f_j
$$
**证明**

取 $f'(S)=f_{|S|},g'(S)=g_{|S|}$，应用子集反演易证。

**推论**

设两个函数 $f, g$ 满足
$$
f_i=\sum_{j=i}^n\binom{j}{i}g_j
$$
那么就有
$$
g_i=\sum_{j=i}^n(-1)^{j-i}\binom{j}{i}f_j
$$
**证明**
$$
\begin{align}
f_i&=\sum_{j=i}^n\binom{j}{i}g_j\\
&=\sum_{j=i}^n\frac{\binom{n-i}{j-i}\binom{n}{i}}{\binom{n}{j}}g_j\\
\frac{f_i}{\binom{n}{i}}&=\sum_{j=i}^n\binom{n-i}{j-i}\frac{g_j}{\binom{n}{j}}
\end{align}
$$
取 $f'(S)=\frac{f_{|S|}}{\binom{n}{|S|}},g'(S)=\frac{g_{|S|}}{\binom{n}{|S|}}$，应用子集反演易证。

**定理（广义容斥原理）**

记
$$
\alpha_i=\sum_{S\subseteq\binom{\{1,2,\dots,n\}}{i}}\left|\bigcap_{i\in S}A_i\right|
$$

$$
\beta_i=\sum_{S\subseteq\binom{\{1,2,\dots,n\}}{i}}\left|\bigcap_{i\in S}A_i\cap\bigcap_{i\notin S}\overline{A_i}\right|
$$

那么就有
$$
\beta_i=\sum_{j=i}^n(-1)^{j-i}\binom{j}{i}\alpha_j
$$
**证明**

易证
$$
\alpha_i=\sum_{j=i}^n\binom{j}{i}\beta_j
$$
应用二项式反演有
$$
\beta_i=\sum_{j=i}^n(-1)^{j-i}\binom{j}{i}\alpha_j
$$
**定理（Min-Max 容斥）**

对于任意实数序列 $a = \langle a_1,a_2,\dots,a_n\rangle$，有
$$
\min_{i=1}^na_i=\sum_{\empty\subset S\subseteq\{1,2,\dots,n\}}(-1)^{|S|-1}\max_{i\in S}a_i
$$
**证明**

不失一般性地，设 $a$ 有序。
$$
\begin{align}
\sum_{\empty\subset S\subseteq\{1,2,\dots,n\}}(-1)^{|S|-1}\max_{i\in S}a_i&=\sum_{i=1}^na_i\sum_{S\subseteq\{1,2,\dots,i-1\}}(-1)^{|S|}\\
&=\sum_{i=1}^na_i\sum_{j=0}^{i-1}\binom{i-1}{j}(-1)^j\\
&=\sum_{i=1}^na_i[i-1=0]\\
&=a_1\\
&=\min_{i=1}^na_i
\end{align}
$$
**推论**

对于任意实数序列 $a = \langle a_1,a_2,\dots,a_n\rangle$，有
$$
\max_{i=1}^na_i=\sum_{\empty\subset S\subseteq\{1,2,\dots,n\}}(-1)^{|S|-1}\min_{i\in S}a_i
$$
**推论**

对于任意 $n$ 个随机变量 $x=\langle x_1,x_2,\dots,x_n\rangle$，有
$$
\mathbb{E}\left[\min_{i=1}^nx_i\right]=\sum_{\empty\subset S\subseteq\{1,2,\dots,n\}}(-1)^{|S|-1}\mathbb{E}\left[\max_{i\in S}x_i\right]
$$
**证明**
$$
\begin{align}
\mathbb{E}\left[\min_{i=1}^nx_i\right]&=\sum_{y}\Pr[y=x]\min_{i=1}^ny_i\\
&=\sum_{y}\Pr[y=x]\sum_{\empty\subset S\subseteq\{1,2,\dots,n\}}(-1)^{|S|-1}\max_{i\in S}y_i\\
&=\sum_{\empty\subset S\subseteq \{1,2,\dots,n\}}(-1)^{|S|-1}\sum_y\Pr[y=x]\max_{i\in S}y_i\\
&=\sum_{\empty\subset S\subseteq \{1,2,\dots,n\}}(-1)^{|S|-1}\mathbb{E}\left[\max_{i\in S}x_i\right]
\end{align}
$$
**推论**

对于任意 $n$ 个随机变量 $x=\langle x_1,x_2,\dots,x_n\rangle$，有
$$
\mathbb{E}\left[\max_{i=1}^nx_i\right]=\sum_{\empty\subset S\subseteq\{1,2,\dots,n\}}(-1)^{|S|-1}\mathbb{E}\left[\min_{i\in S}x_i\right]
$$
**推论**

对于任意正整数序列 $a=\langle a_1,a_2,\dots,a_n\rangle$，有
$$
\gcd_{i=1}^na_i=\prod_{\empty\subset S\subseteq\{1,2,\dots,n\}}\left(\operatorname*{lcm}_{i\in S}a_i\right)^{(-1)^{|S|-1}}
$$
**证明**
$$
\begin{align}
\gcd_{i=1}^na_i&=\gcd_{i=1}^n\prod_{p\in\mathbb{P}}p^{\nu_p(a_i)}\\
&=\prod_{p\in\mathbb{P}}p^{\min_{i=1}^n\nu_p(a_i)}\\
&=\prod_{p\in\mathbb{P}}p^{\sum_{\empty\subset S\subseteq\{1,2,\dots,n\}}(-1)^{|S|-1}\max_{i\in S}\nu_p(a_i)}\\
&=\prod_{p\in\mathbb{P}}\prod_{\empty\subset S\subseteq\{1,2,\dots,n\}}p^{(-1)^{|S|-1}\max_{i\in S}\nu_p(a_i)}\\
&=\prod_{\empty\subset S\subseteq\{1,2,\dots,n\}}\left(\prod_{p\in\mathbb{P}}p^{\max_{i\in S}\nu_p(a_i)}\right)^{(-1)^{|S|-1}}\\
&=\prod_{\empty\subset S\subseteq\{1,2,\dots,n\}}\left(\operatorname*{lcm}_{i\in S}\prod_{p\in\mathbb{P}}p^{\nu_p(a_i)}\right)^{(-1)^{|S|-1}}\\
&=\prod_{\empty\subset S\subseteq\{1,2,\dots,n\}}\left(\operatorname*{lcm}_{i\in S}a_i\right)^{(-1)^{|S|-1}}
\end{align}
$$
**推论**

对于任意正整数序列 $a=\langle a_1,a_2,\dots,a_n\rangle$，有
$$
\operatorname*{lcm}_{i=1}^na_i=\prod_{\empty\subset S\subseteq\{1,2,\dots,n\}}\left(\gcd_{i\in S}a_i\right)^{(-1)^{|S|-1}}
$$
**定理（Kth-Min-Max 容斥）**

对于任意实数序列 $a = \langle a_1,a_2,\dots,a_n\rangle$，$k\in\Z^+\wedge k\le n$，有
$$
{\operatorname*{kthmin}_{i=1}^n}_ka_i=\sum_{\empty\subset S\subseteq\{1,2,\dots,n\}}(-1)^{|S|-k}\binom{|S|-1}{k-1}\max_{i\in S}a_i
$$
**证明**

不失一般性地，设 $a$ 有序。
$$
\begin{align}
\sum_{\empty\subset S\subseteq\{1,2,\dots,n\}}(-1)^{|S|-k}\binom{|S|-1}{k-1}\max_{i\in S}a_i&=\sum_{i=1}^na_i\sum_{S\subseteq\{1,2,\dots,i-1\}}(-1)^{|S|-k+1}\binom{|S|}{k-1}\\
&=\sum_{i=1}^na_i\sum_{j=0}^{i-1}\binom{i-1}{j}\binom{j}{k-1}(-1)^{j-k+1}\\
&=\sum_{i=1}^na_i\binom{i-1}{k-1}\sum_{j=0}^{i-1}\binom{i-k}{j-k+1}(-1)^{j-k+1}\\
&=\sum_{i=1}^na_i\binom{i-1}{k-1}\sum_{j=0}^{i-k}\binom{i-k}{j}(-1)^{j}\\
&=\sum_{i=1}^na_i\binom{i-1}{k-1}[i-k=0]\\
&=a_k\\
&={\operatorname*{kthmin}_{i=1}^n}_ka_i
\end{align}
$$
**推论**

对于任意实数序列 $a = \langle a_1,a_2,\dots,a_n\rangle$，$k\in\Z^+\wedge k\le n$，有
$$
{\operatorname*{kthmax}_{i=1}^n}_ka_i=\sum_{\empty\subset S\subseteq\{1,2,\dots,n\}}(-1)^{|S|-k}\binom{|S|-1}{k-1}\min_{i\in S}a_i
$$
**推论**

对于任意 $n$ 个随机变量 $x = \langle x_1,x_2,\dots,x_n\rangle$，$k\in\Z^+\wedge k\le n$，有
$$
\mathbb{E}\left[{\operatorname*{kthmin}_{i=1}^n}_ka_i\right]=\sum_{\empty\subset S\subseteq\{1,2,\dots,n\}}(-1)^{|S|-k}\binom{|S|-1}{k-1}\mathbb{E}\left[\max_{i\in S}a_i\right]
$$
**推论**

对于任意 $n$ 个随机变量 $x = \langle x_1,x_2,\dots,x_n\rangle$，$k\in\Z^+\wedge k\le n$，有
$$
\mathbb{E}\left[{\operatorname*{kthmax}_{i=1}^n}_ka_i\right]=\sum_{\empty\subset S\subseteq\{1,2,\dots,n\}}(-1)^{|S|-k}\binom{|S|-1}{k-1}\mathbb{E}\left[\min_{i\in S}a_i\right]
$$
**推论**

对于任意正整数序列 $a=\langle a_1,a_2,\dots,a_n\rangle$，$k\in\Z^+\wedge k\le n$，有
$$
{\operatorname*{kthgcd}_{i=1}^n}_ka_i=\prod_{\empty\subset S\subseteq\{1,2,\dots,n\}}\left(\operatorname*{lcm}_{i\in S}a_i\right)^{(-1)^{|S|-k}\binom{|S|-1}{k-1}}
$$
**推论**

对于任意正整数序列 $a=\langle a_1,a_2,\dots,a_n\rangle$，$k\in\Z^+\wedge k\le n$，有
$$
{\operatorname*{kthlcm}_{i=1}^n}_ka_i=\prod_{\empty\subset S\subseteq\{1,2,\dots,n\}}\left(\gcd_{i\in S}a_i\right)^{(-1)^{|S|-k}\binom{|S|-1}{k-1}}
$$
